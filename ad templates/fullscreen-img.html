<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Closable</title>
    <style>
      html,
      body,
      div,
      img,
      video,
      iframe,
      a,
      button {
        cursor: pointer;
        margin: 0;
        padding: 0;
      }

      a:focus,
      button:focus {
        outline: none;
      }

      button:hover {
        opacity: 1;
      }

      #tracking-code,
      #impression-code,
      #html {
        display: none;
      }

      #close {
        position: absolute;
        background-size: 42px;
        border-radius: 21px;
        width: 42px;
        height: 42px;
        border: none;
        z-index: 10000;
        opacity: 1;
        right: 20px;
        top: 10px;
      }

      #closetext {
        position: absolute;
        width: auto;
        height: 20px;
        padding: 10px;
        border: none;
        bottom: 10%;
        right: 55%;
        background-color: black;
        color: white;
        font: 400 12px/1 "Roboto", sans-serif;
      }

      .spin-mouse-on {
        animation: spinMouseOn 0.5s ease;
      }

      .spin-mouse-off {
        animation: spinMouseOff 0.5s ease;
      }

      @keyframes spinMouseOn {
        100% {
          transform: rotate(0.5turn);
        }
      }

      @keyframes spinMouseOff {
        100% {
          transform: rotate(-0.5turn);
        }
      }

      .close-btn {
        background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09JREFUeNrM2i+P4kAUAPC2qrJBEUjI4pBkzZWAQK7bStzh7hPwLfgAJ1kDJ/ccEgGhhgS5skGQyso6bh73yvVIO7x5nZa+ZLK7LIX+Ov9eZ2oamuJyufTEj6YoL6I4WLIiFiXEEkAxTTMu+v2mhpOH0i94Hl9QBOhYKUQA4MTHkqvOjUiUDQdkKgKg2bxhEyozALQWoC/tEIEAgGtUGwD5pPQhkwCwxY9pBbWQFyFiQjZEIODkJyX0BdWAGlnIMOYDBNSEbdQjpBhL0pwmNUIYeC5TvMA0CNaEY9QvrhcYL7QcgqNT06hvwAX2pBCcJ8hD7Gw267fb7R+n04ndBOFY+IzRaPSucFgPs4rcGnlTQczn8/fz+dwcDAbfORg4Bo6Fz9jtdn1FjJduYtZd2tFUQSR/czBpRPKaIsZOt550jYw5CA4mC8HEuEmtWKks1uEiVDAyBANjJ5l3UiM9Cn+5XH579B4ZhoJI4nA49Hzfp0wB/0FI9xP7/f6j1WqFHIwKwrbteLVafbiuGxFOqylalGNis5oU6aR5AWjAw++qCM/zQoURbA2QMbWjczFJLZWEuKb7AJnifbZRFoY0lvIR1xsxi5tTdTqdmNpnSkZc0xY2RBdGA0Ka/VaC0YXQAuFidCK0QTjRaDSi19fXSNfnaYFwRrAiWXMpkCLDsE6MhTf1lSN0YyxcN3oKQiMmZkFUE0BuoqkQAUCCMhEwxBbJmkuBcBAwT6jMM0xMYOECMWnVu0gqXiImgtXHZPglQbrdbshBcDDwXfB+wmkdb/MIbqw8nGW32+3v4XB4LJJ2UDDwHfBdxGbl30+IG8pReRiV3EmGUUQck72TG4RaK1kYTgKYhVFEAGB9O//0f1Tv32HJBlY7imSxyUgIfUIB8fc+3TT9TAhiJtTloWsD9X2HuNohxRA79m24FYhF+oUsyLO32ihN6qeARNLsFzvPZ5FksuT4dY/ITeNxe2tRQwxsimZmIpTNUGhmdk0QuXMYZXv62Tu7MTYnaU5IemAABwBPZTTTFAHWxMNRUfURjh6C7ApqYZOeJ7RCUrXjYikDdMTJTmmgYT/mhKA+lqJzToQAn/vslqnjEsL+BPafF0Q5hKYTGP8ePCu8SPdHgAEAMc+MsVUNF0AAAAAASUVORK5CYII=");
      }

      #click-overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        top: 0;
        display: none;
      }

      #container {
        width: 100vw;
        height: 100%;
        height: 100dvh;
        overflow: hidden;
        padding: 0;
        margin: 0;
        background-color: black;
        font: 400 16px/1.5 "Roboto", sans-serif;
      }

      @media screen and (orientation: portrait) and (min-width: 900px) {
        #canvas {
          padding: 0;
        }
      }

      @media screen and (orientation: landscape) and (min-width: 900px) {
        #canvas {
          padding: 0 20vw;
        }
      }

      @media screen and (orientation: portrait) and (max-width: 950px) {
        #canvas {
          padding: 0;
        }
      }

      @media screen and (orientation: landscape) and (max-width: 950px) {
        #canvas {
          padding: 0 20vw;
        }
      }

      #counter {
        position: absolute;
        top: 31px;
        left: 30px;
        transform: translateX(-50%) translateY(-50%);
        background-color: #fff;
        width: 42px;
        height: 42px;
        border: none;
        border-radius: 23px;
        opacity: 1;
        text-align: center;
        vertical-align: middle;
        font-size: 14px;
        font-weight: 700;
        line-height: 42px;
      }

      .lds-ring {
        display: inline-block;
        width: 43px;
        height: 43px;
        position: absolute;
        top: 30px;
        right: 3px;
        transform: translateX(-50%) translateY(-50%);
      }

      .lds-ring div {
        box-sizing: border-box;
        display: block;
        position: absolute;
        width: 43px;
        height: 43px;
        margin: 0px;
        border: 5px solid #000;
        border-radius: 50%;
        animation: lds-ring 1.2s infinite;
        border-color: #000 transparent transparent transparent;
      }

      .lds-ring div:nth-child(1) {
        animation-delay: -0.3s;
      }

      .lds-ring div:nth-child(2) {
        animation-delay: -0.2s;
      }

      .lds-ring div:nth-child(3) {
        animation-delay: -0.1s;
      }

      @keyframes lds-ring {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div id="container">
      <div id="click-overlay" onclick="event.stopPropagation(); banner.click();">
        <div id="counter"></div>
      </div>
      <div id="canvas">
        <div id="image" onclick="banner.click()"></div>
        <div id="iframe"></div>
        <div id="html">[%html%]</div>
      </div>

      <img id="impression-code" src="%%VIEW_URL_UNESC%%" />
      <div id="tracking-code">[%trackingCode%]</div>
    </div>
    <div>
      <button class="close-btn" id="close" onclick="banner.close()"></button>
    </div>
    <script>
      var banner = {
        build: function () {
          this.setVariables();
          this.fillCanvas();
          this.configureFrame();
        },

        setVariables: function () {
          this.variables = {};
          this.setVariable("adUnit", "%%ADUNIT%%");
          this.setVariable("cachebuster", "%%CACHEBUSTER%%");
          this.setVariable("clickMacroUrl", "%%CLICK_URL_ESC%%");
          this.setVariable("destinationUrl", "%%DEST_URL_ESC%%");
          this.setVariable("imageUrl", "[%imageUrl%]");
          this.setVariable("iframeUrl", "[%iframeUrl%]");
          this.setVariable("reTargetingPixelUrl", "[%reTargetingPixelUrl%]");
          this.setVariable("timeout", "[%timeout%]");
        },

        setVariable: function (name, value) {
          this.variables[name] = value.length > 0 ? value : "";
        },

        click: function () {
          if (this.variables.reTargetingPixelUrl.length > 0) {
            this.appendReTargetingPixel();
          }
          window.open(this.variables.clickMacroUrl + this.variables.destinationUrl, "_blank");
        },

        appendReTargetingPixel: function () {
          var pixelImg = document.createElement("img");
          pixelImg.src = this.variables.reTargetingPixelUrl;
          document.getElementById("container").appendChild(pixelImg);
        },

        fillCanvas: function () {
          if (this.variables.imageUrl.length > 0) {
            this.setImageContent();
          } else if (this.variables.iframeUrl.length > 0) {
            this.setIframeContent();
          } else {
            document.getElementById("html").style.display = "block";
          }
          document.getElementById("click-overlay").style.display = "block";
        },

        setImageContent: function () {
          var image = document.createElement("img");
          image.src = this.variables.imageUrl;
          image.style.width = "100%";
          image.style.height = "100%";
          document.getElementById("image").appendChild(image);
        },

        setIframeContent: function () {
          var iframe = document.createElement("iframe");
          iframe.src = this.variables.iframeUrl + "?clickTag=" + this.variables.clickMacroUrl + this.variables.destinationUrl + "&clickMacro=" + this.variables.clickMacroUrl;
          iframe.scrolling = "no";
          iframe.rel = "nofollow";
          iframe.width = "100%";
          iframe.height = "100%";
          iframe.frameborder = "0px";
          iframe.style.border = "none";
          iframe.style.overflow = "hidden";
          document.getElementById("iframe").appendChild(iframe);
        },

        configureFrame: function () {
          this.setStylesToElement(window.frameElement, {
            position: "fixed",
            width: "100%",
            height: "100%",
            top: "0px",
            left: "0px",
            overflow: "hidden",
            zIndex: "10000",
          });

          if (screen.height > screen.width) {
            /*1.369 on algse formaadi 650x890 kuvasuhe*/
            var cheight = document.getElementById("canvas").clientWidth * 1.369;
            /*60 on mobiilseadme tegumiriba + urliriba (25+35px)*/
            var uppad = (screen.height - 60 - cheight) / 2;
            /*closebutton enlarged*/
            uppad = uppad + 15;
            if (uppad > 75) {
              uppad = 75;
            }
            document.getElementById("canvas").style.paddingTop = uppad.toString() + "px";
          }
          window.frameElement.classList.add("fullscreen-banner-iframe");

          var closeBtn = document.getElementById("close");

          closeBtn.addEventListener("mouseover", function () {
            closeBtn.classList.remove("spin-mouse-off");
            closeBtn.classList.add("spin-mouse-on");
          });

          closeBtn.addEventListener("mouseleave", function () {
            closeBtn.classList.remove("spin-mouse-on");
            closeBtn.classList.add("spin-mouse-off");
          });

          var css = ".fullscreen-banner-iframe { width: 100vw !important;box-shadow: rgb(62, 62, 67, 0.75) 0px 0px 15px !important; animation: easeStickyBannerIn 1s ease; } @keyframes easeStickyBannerIn { 0% { opacity: 0; } 100% { opacity: 1; } }";
          this.appendStyleToParent(css);

          if (this.variables.timeout > 0) {
            this.counter = this.variables.timeout;
            this.countDown = setInterval(this.counting.bind(this), 1000);
            document.getElementById("counter").innerHTML = this.counter;
          }
        },

        close: function () {
          window.frameElement.outerHTML = "";
        },

        counting: function () {
          this.counter = this.counter - 1;
          document.getElementById("counter").innerHTML = this.counter;
          if (this.counter < 1) {
            clearInterval(this.countDown);
            this.close();
          }
        },

        appendStyleToParent: function (css) {
          var style = document.createElement("style");
          style.type = "text/css";

          if (style.styleSheet) {
            style.styleSheet.cssText = css;
          } else {
            style.appendChild(document.createTextNode(css));
          }

          window.parent.document.getElementsByTagName("head")[0].appendChild(style);
        },

        setStylesToElement: function (el, styles) {
          var keys = Object.keys(styles);
          keys.forEach(function (key) {
            if (Array.isArray(styles[key])) {
              var css = el.style.cssText;
              styles[key].forEach(function (value) {
                css = css + " " + key + ": " + value + ";";
              });
              el.style.cssText = css;
            } else {
              el.style[key] = styles[key];
            }
          });
        },
      };

      banner.build();
    </script>
  </body>
</html>
