<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Universal Ad Banner Template</title>
    <style>
      /* ====================================================================
         GLOBAL RESET AND BASE STYLES
         ==================================================================== */

      /* Reset all margins and paddings, set cursor to pointer for interactivity */
      html,
      body,
      div,
      img,
      video,
      iframe,
      a,
      button {
        cursor: pointer;
        margin: 0;
        padding: 0;
      }

      /* Remove focus outlines for cleaner UI */
      a:focus,
      button:focus {
        outline: none;
      }

      button:hover {
        opacity: 1;
      }

      /* ====================================================================
         HIDDEN ELEMENTS
         These elements store tracking codes and HTML content but are not 
         displayed by default
         ==================================================================== */

      #tracking-code,
      #impression-code,
      #html {
        display: none;
      }

      /* ====================================================================
         VIDEO CONTROLS
         Custom play/pause and mute/unmute buttons for video banners
         Positioned at top-right of video container
         Hidden by default, shown when videoButtons variable is set
         ==================================================================== */

      #video-controls {
        display: none;
        /* Hidden by default, shown via JavaScript when needed */
        position: absolute;
        top: 10px;
        right: 20px;
        /* Moved from 10px to 20px for better spacing from edge */
        z-index: 100;
        /* Above video content */
      }

      #video-controls > button {
        position: relative;
        background-color: transparent;
        background-size: 30px;
        background-repeat: no-repeat;
        background-position: center;
        width: 30px;
        height: 30px;
        border: none;
        opacity: 0.7;
        border-radius: 15px;
        cursor: pointer;
        margin-left: 5px;
        display: inline-block;
      }

      #video-controls > button:hover {
        opacity: 1;
      }

      /* Remove focus outlines and prevent blue container effect */
      #video-controls > button:focus {
        outline: none;
        box-shadow: none;
      }

      /* Ensure SVG elements don't trigger unwanted focus effects */
      #video-controls > button svg {
        pointer-events: none;
        /* Prevents SVG from being the focus target */
      }

      /* Volume button - no background image, uses inline SVG */
      #video-control-audio {
        background-image: none !important;
      }

      /* ====================================================================
         CLOSE BUTTON STYLES
         SVG close button positioned below banner with 64px gap
         Centered horizontally via flexbox in container
         ==================================================================== */

      #close {
        position: relative;
        /* Position within flex container */
        width: 48px;
        height: 48px;
        border: none;
        background: transparent;
        padding: 0;
        cursor: pointer;
        z-index: 10000;
        /* Ensures button stays above all content */
        opacity: 1;
        flex-shrink: 0;
        /* Prevent button from shrinking */
      }

      #close svg {
        display: block;
        width: 100%;
        height: 100%;
      }

      /* ====================================================================
         CLICK OVERLAY
         Transparent clickable layer that covers the entire content area
         Handles click-through to destination URL
         ==================================================================== */

      #click-overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        /* Above content but below close button */
        top: 0;
        display: none;
        /* Hidden until content is loaded */
      }

      /* ====================================================================
         MAIN CONTAINER
         Full viewport container using dvh (dynamic viewport height) units
         dvh accounts for mobile browser UI elements that appear/disappear
         ==================================================================== */

      #container {
        width: 100vw;
        height: 100dvh;
        /* Dynamic viewport height - mobile-friendly */
        overflow: hidden;
        padding: 0;
        margin: 0;
        background-color: black;
        font: 400 16px/1.5 "Roboto", sans-serif;

        /* Flexbox for centering content */
        display: flex;
        flex-direction: column;
        align-items: center;
        /* Horizontal centering */
        justify-content: center;
        /* Vertical centering */
        gap: 16px;
        /* Gap between banner and close button */
      }

      /* Prevent focus outline on container */
      #container:focus {
        outline: none;
      }

      /* ====================================================================
         ASPECT RATIO CONTAINER
         This is the key to maintaining 650×890 proportions
         Uses modern CSS aspect-ratio property with fallback calculations
         ==================================================================== */

      #canvas {
        margin-top: 5dvh;
        position: relative;
        width: 100%;
        max-width: 100vw;
        max-height: 100dvh;

        /* 
         * ASPECT RATIO CALCULATION:
         * 650÷890 = 0.73033 (approximately 73:100 ratio)
         * This ensures content always maintains original proportions
         * regardless of screen size or orientation
         */
        aspect-ratio: 650 / 890;

        /* 
         * RESPONSIVE SIZING:
         * Container will scale to fit viewport while maintaining aspect ratio
         * On narrow screens: width-constrained (100vw)
         * On tall screens: height-constrained (100dvh)
         */

        /* Background for debugging - can be removed */
        background-color: transparent;

        /* Ensure content doesn't overflow the aspect ratio box */
        overflow: hidden;
      }

      /* Prevent focus outline on canvas */
      #canvas:focus {
        outline: none;
      }

      /* 
       * FALLBACK FOR BROWSERS WITHOUT ASPECT-RATIO SUPPORT
       * Uses padding-top trick: (890/650)*100 = 136.92%
       * This creates the same aspect ratio using vertical padding
       */
      @supports not (aspect-ratio: 650 / 890) {
        #canvas {
          height: 0;
          padding-top: 136.92%;
          /* (890/650)*100 */
        }

        #canvas > * {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        }
      }

      /* ====================================================================
         CONTENT CONTAINERS
         Separate containers for different banner types (image, video, iframe, HTML)
         All positioned absolutely to fill the canvas
         ==================================================================== */

      #image,
      #video,
      #iframe,
      #html {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      /* Prevent focus effects on content containers */
      #image:focus,
      #video:focus,
      #iframe:focus,
      #html:focus {
        outline: none;
      }

      /* Images should fill container while maintaining aspect ratio */
      #image img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        /* Maintains aspect ratio, adds letterboxing if needed */
        display: block;
      }

      /* Video element styling - fills container with aspect ratio preservation */
      #video video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        /* Maintains video aspect ratio, adds letterboxing if needed */
        display: block;
      }

      /* Iframe styling for HTML banners */
      #iframe iframe {
        width: 100%;
        height: 100%;
        border: none;
        overflow: hidden;
      }

      /* HTML content container */
      #html {
        display: none;
        /* Hidden by default, shown when HTML content is used */
      }

      /* ====================================================================
         COUNTDOWN TIMER
         Text-based timer showing "Ad closes in X seconds"
         Positioned at top center of banner
         ==================================================================== */

      #counter {
        position: absolute;
        top: 2.5dvh;
        left: 50%;
        transform: translateX(-50%);
        /* Center horizontally */
        background-color: rgba(0, 0, 0, 0.7);
        /* Semi-transparent dark background */
        color: #fff;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 400;
        font-family: "Roboto", sans-serif;
        white-space: nowrap;
        z-index: 2;
        /* Above content but below close button */
        opacity: 1;
      }
    </style>
  </head>

  <body>
    <!-- MAIN CONTAINER: Full viewport wrapper with centering -->
    <div id="container">
      <!-- CLICK OVERLAY: Handles clicks to destination URL -->
      <!-- 
        - onclick stops event propagation to prevent conflicts
        - Calls banner.handleClick() method to handle clickthrough
        - REFACTORED: Updated to use new handleClick method name
      -->
      <div id="click-overlay" onclick="event.stopPropagation(); banner.handleClick();"></div>

      <!-- COUNTDOWN TIMER: Text-based timer at top center -->
      <!-- Shows "Ad closes in X seconds" message -->
      <div id="counter"></div>

      <!-- ASPECT RATIO CANVAS: Maintains 650×890 proportions -->
      <!-- 
        - All content types render inside this container
        - aspect-ratio CSS property ensures proportional scaling
        - Max constraints prevent overflow on any screen size
      -->
      <div id="canvas">
        <!-- IMAGE BANNER CONTAINER -->
        <!-- 
          - Dynamically populated when imageUrl variable is provided
          - onclick handler allows clicking image to navigate
          - REFACTORED: Updated to use new handleClick method name
        -->
        <div id="image" onclick="banner.handleClick()"></div>

        <!-- VIDEO BANNER CONTAINER -->
        <!-- 
          - Dynamically populated when videoUrl variable is provided
          - Uses HTML5 video element with mobile-optimized attributes
          - autoplay: Starts automatically (muted for mobile compatibility)
          - loop: Repeats continuously
          - muted: Required for autoplay on mobile browsers
          - playsinline: Plays inline on iOS instead of fullscreen
          - poster: Optional thumbnail image shown before playback
          - onclick: Allows clicking video to navigate to destination
        -->
        <div id="video">
          <video autoplay loop muted playsinline onclick="banner.handleClick()">
            <!-- Video source dynamically added via JavaScript -->
          </video>
          <!-- VIDEO CONTROLS: Mute/unmute button with inline SVG -->
          <div id="video-controls">
            <button id="video-control-audio" onclick="event.stopPropagation(); banner.toggleVideoAudio();">
              <!-- Volume On SVG (default state - video starts muted) -->
              <svg class="volume-on" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none" style="display: none;">
                <path d="M38.4231 23.95C38.4231 20.936 37.5831 18.2148 35.9031 15.7865C34.2231 13.3578 32.0118 11.5803 29.2691 10.454C28.9461 10.313 28.7206 10.1072 28.5926 9.83649C28.4643 9.56616 28.4689 9.29033 28.6066 9.00899C28.7383 8.70299 28.9739 8.50066 29.3136 8.40199C29.6533 8.30333 29.9949 8.32449 30.3386 8.46549C33.4489 9.79383 35.9521 11.8487 37.8481 14.63C39.7441 17.4117 40.6921 20.5182 40.6921 23.9495C40.6921 27.3805 39.7441 30.487 37.8481 33.269C35.9521 36.051 33.4489 38.1062 30.3386 39.4345C29.9949 39.5755 29.6533 39.5967 29.3136 39.498C28.9739 39.3993 28.7383 39.197 28.6066 38.891C28.4689 38.6097 28.4643 38.3338 28.5926 38.0635C28.7206 37.7928 28.9461 37.587 29.2691 37.446C32.0118 36.3197 34.2231 34.5422 35.9031 32.1135C37.5831 29.6852 38.4231 26.964 38.4231 23.95ZM14.7311 29H8.75011C8.33277 29 7.98811 28.864 7.71611 28.592C7.44411 28.3197 7.30811 27.9748 7.30811 27.5575V20.4425C7.30811 20.0252 7.44411 19.6803 7.71611 19.408C7.98811 19.136 8.33277 19 8.75011 19H14.7311L21.3346 12.3965C21.6986 12.0322 22.1184 11.9477 22.5941 12.143C23.0698 12.338 23.3076 12.6827 23.3076 13.177V34.8035C23.3076 35.3108 23.0698 35.662 22.5941 35.857C22.1184 36.0523 21.6986 35.9678 21.3346 35.6035L14.7311 29ZM32.3076 24.002C32.3076 25.4933 31.9641 26.8517 31.2771 28.077C30.5898 29.3027 29.6109 30.268 28.3406 30.973C28.1109 31.1217 27.8878 31.1255 27.6711 30.9845C27.4544 30.8435 27.3461 30.646 27.3461 30.392V17.5385C27.3461 17.2848 27.4544 17.0907 27.6711 16.956C27.8878 16.8213 28.1109 16.8208 28.3406 16.9545C29.6109 17.6618 30.5898 18.6457 31.2771 19.906C31.9641 21.166 32.3076 22.5313 32.3076 24.002ZM21.0386 16.1575L15.7541 21.2695H9.5771V26.7305H15.7541L21.0386 31.873V16.1575Z" fill="white"/>
              </svg>
              <!-- Volume Off SVG (shown when video is muted - initial state) -->
              <svg class="volume-off" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                <path d="M35.5271 25.6305L30.7921 30.396C30.5691 30.619 30.3058 30.7338 30.0021 30.7405C29.6981 30.7468 29.4346 30.632 29.2116 30.396C28.9756 30.1603 28.8576 29.8887 28.8576 29.581C28.8576 29.273 28.9756 29.0012 29.2116 28.7655L33.9271 24.031L29.1616 19.296C28.9386 19.073 28.8239 18.8128 28.8176 18.5155C28.8109 18.2182 28.9256 17.9515 29.1616 17.7155C29.3976 17.4795 29.6726 17.3615 29.9866 17.3615C30.3006 17.3615 30.5691 17.4795 30.7921 17.7155L35.5271 22.431L40.2616 17.6655C40.4846 17.4425 40.7481 17.331 41.0521 17.331C41.3558 17.331 41.6256 17.4425 41.8616 17.6655C42.0976 17.9015 42.2156 18.1765 42.2156 18.4905C42.2156 18.8045 42.0976 19.073 41.8616 19.296L37.1271 24.031L41.8921 28.7655C42.1154 28.9885 42.2303 29.252 42.2366 29.556C42.2429 29.8597 42.1281 30.1295 41.8921 30.3655C41.6564 30.6012 41.3848 30.719 41.0771 30.719C40.7694 30.719 40.4976 30.6012 40.2616 30.3655L35.5271 25.6305ZM14.7311 29H8.75011C8.32977 29 7.98427 28.8647 7.71361 28.594C7.44327 28.3237 7.30811 27.9782 7.30811 27.5575V20.4425C7.30811 20.0218 7.44327 19.6763 7.71361 19.406C7.98427 19.1353 8.32977 19 8.75011 19H14.7311L21.3346 12.3965C21.6986 12.0322 22.1184 11.9462 22.5941 12.1385C23.0698 12.3308 23.3076 12.677 23.3076 13.177V34.8035C23.3076 35.3165 23.0698 35.6692 22.5941 35.8615C22.1184 36.0538 21.6986 35.9678 21.3346 35.6035L14.7311 29ZM21.0386 16.1575L15.7541 21.2695H9.5771V26.7305H15.7541L21.0386 31.873V16.1575Z" fill="white"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- IFRAME BANNER CONTAINER -->
        <!-- 
          - Used for external HTML5 banners
          - clickTag and clickMacro passed as URL parameters
          - Scrolling disabled, no borders for seamless integration
        -->
        <div id="iframe"></div>

        <!-- INLINE HTML BANNER CONTAINER -->
        <!-- 
          - Used for HTML code provided directly in template
          - Hidden by default, shown when [%html%] variable has content
          - WARNING: HTML banners set to 100vw×100vh will be constrained
            to the 650×890 aspect ratio box, NOT full screen
        -->
        <div id="html">[%html%]</div>
      </div>

      <!-- CLOSE BUTTON -->
      <!-- 
        - Positioned below banner with 64px gap via flexbox
        - Centered horizontally via container alignment
        - High z-index (10000) ensures it's always clickable
        - onclick calls banner.close() to remove ad from DOM
        - Inline SVG for clean vector graphics
      -->
      <button id="close" onclick="banner.close()">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
          <path d="M24 25.6L30.623 32.223C30.846 32.446 31.1095 32.5608 31.4135 32.5675C31.7172 32.5738 31.987 32.459 32.223 32.223C32.459 31.987 32.577 31.7203 32.577 31.423C32.577 31.1257 32.459 30.859 32.223 30.623L25.6 24L32.223 17.377C32.446 17.154 32.5608 16.8905 32.5675 16.5865C32.5738 16.2828 32.459 16.013 32.223 15.777C31.987 15.541 31.7203 15.423 31.423 15.423C31.1257 15.423 30.859 15.541 30.623 15.777L24 22.4L17.377 15.777C17.154 15.554 16.8905 15.4392 16.5865 15.4325C16.2828 15.4262 16.013 15.541 15.777 15.777C15.541 16.013 15.423 16.2797 15.423 16.577C15.423 16.8743 15.541 17.141 15.777 17.377L22.4 24L15.777 30.623C15.554 30.846 15.4392 31.1095 15.4325 31.4135C15.4262 31.7172 15.541 31.987 15.777 32.223C16.013 32.459 16.2797 32.577 16.577 32.577C16.8743 32.577 17.141 32.459 17.377 32.223L24 25.6ZM24.0035 43C21.3962 43 18.9395 42.5013 16.6335 41.504C14.3275 40.5067 12.311 39.1448 10.584 37.4185C8.857 35.6922 7.4945 33.6765 6.4965 31.3715C5.49883 29.0668 5 26.6108 5 24.0035C5 21.3755 5.49867 18.9053 6.496 16.593C7.49333 14.2807 8.85517 12.2693 10.5815 10.559C12.3078 8.84867 14.3235 7.4945 16.6285 6.4965C18.9332 5.49883 21.3892 5 23.9965 5C26.6245 5 29.0947 5.49867 31.407 6.496C33.7193 7.49333 35.7307 8.84683 37.441 10.5565C39.1513 12.2662 40.5055 14.2767 41.5035 16.588C42.5012 18.8993 43 21.3688 43 23.9965C43 26.6038 42.5013 29.0605 41.504 31.3665C40.5067 33.6725 39.1532 35.689 37.4435 37.416C35.7338 39.143 33.7233 40.5055 31.412 41.5035C29.1007 42.5012 26.6312 43 24.0035 43ZM24 40.7305C28.6563 40.7305 32.6088 39.1012 35.8575 35.8425C39.1062 32.5835 40.7305 28.636 40.7305 24C40.7305 19.3437 39.1062 15.3912 35.8575 12.1425C32.6088 8.89383 28.6563 7.2695 24 7.2695C19.364 7.2695 15.4165 8.89383 12.1575 12.1425C8.89883 15.3912 7.2695 19.3437 7.2695 24C7.2695 28.636 8.89883 32.5835 12.1575 35.8425C15.4165 39.1012 19.364 40.7305 24 40.7305Z" fill="white"/>
        </svg>
      </button>

      <!-- IMPRESSION TRACKING PIXEL -->
      <!-- 
        - Google Ad Manager macro %%VIEW_URL_UNESC%% fires impression
        - Hidden 1×1 pixel image loaded when banner displays
      -->
      <img id="impression-code" src="%%VIEW_URL_UNESC%%" />

      <!-- ADDITIONAL TRACKING CODE -->
      <!-- 
        - Custom tracking scripts can be injected via [%trackingCode%] variable
        - Hidden container, scripts execute but don't display
      -->
      <div id="tracking-code">[%trackingCode%]</div>
    </div>

    <script>
      /* ====================================================================
           BANNER CONTROLLER - Main JavaScript Module
           
           REFACTORED ARCHITECTURE:
           - Centralized countdown logic to eliminate duplication
           - Modular functions for better code organization
           - Semantic naming for improved readability
           - Single responsibility principle for each method
           ==================================================================== */

      var banner = {
        /* ==================================================================
               BUILD METHOD - Entry point, called on page load
               Orchestrates the entire banner initialization sequence
               ================================================================== */

        build: function () {
          this.setVariables(); // Step 1: Parse all macro and template variables
          this.fillCanvas(); // Step 2: Determine content type and render
          this.configureFrame(); // Step 3: Style parent iframe and setup interactions
        },

        /* ==================================================================
               SET VARIABLES - Parse Google Ad Manager Macros and Template Variables
               
               GOOGLE AD MANAGER MACROS (replaced by GAM at runtime):
               - %%ADUNIT%% : Ad unit identifier
               - %%CACHEBUSTER%% : Random number to prevent caching
               - %%CLICK_URL_ESC%% : Click tracking URL (URL-encoded)
               - %%DEST_URL_ESC%% : Final destination URL (URL-encoded)
               - %%VIEW_URL_UNESC%% : Impression tracking URL (unencoded)
               
               CUSTOM TEMPLATE VARIABLES (set in GAM creative):
               - [%imageUrl%] : URL for static image banner
               - [%iframeUrl%] : URL for external HTML5 banner
               - [%html%] : Inline HTML code for banner
               - [%reTargetingPixelUrl%] : Retargeting pixel URL
               - [%timeout%] : Auto-close timer in seconds (0 = disabled)
               - [%trackingCode%] : Additional tracking scripts
               ================================================================== */

        setVariables: function () {
          this.variables = {};

          // Google Ad Manager macros
          this.setVariable("adUnit", "%%ADUNIT%%");
          this.setVariable("cachebuster", "%%CACHEBUSTER%%");
          this.setVariable("clickMacroUrl", "%%CLICK_URL_ESC%%");
          this.setVariable("destinationUrl", "%%DEST_URL_ESC%%");

          // Custom template variables for different banner types
          this.setVariable("imageUrl", "[%imageUrl%]");
          this.setVariable("videoUrl", "[%videoUrl%]");
          this.setVariable("iframeUrl", "[%iframeUrl%]");

          // Video-specific configuration
          this.setVariable("posterUrl", "[%posterUrl%]");
          this.setVariable("videoControls", "[%videoControls%]");

          // Tracking and configuration
          this.setVariable("reTargetingPixelUrl", "[%reTargetingPixelUrl%]");
          this.setVariable("timeout", "[%timeout%]");
        },

        /* ==================================================================
               SET VARIABLE - Helper method to safely set variable values
               
               Parameters:
               - name: Variable identifier
               - value: Macro or template variable string
               
               IMPROVEMENT: Provides consistent empty string fallback to prevent
               undefined values from causing issues in conditional checks
               ================================================================== */

        setVariable: function (name, value) {
          this.variables[name] = value.length > 0 ? value : "";
        },

        /* ==================================================================
               HANDLE CLICK - Process user clicks on banner
               
               REFACTORED: Renamed from 'click' to 'handleClick' for clarity
               
               Clicktag Integration:
               1. Fire retargeting pixel if configured (for audience tracking)
               2. Construct full click URL: clickMacroUrl + destinationUrl
               3. Open destination in new tab (_blank)
               
               IMPORTANT: This is the standard Google Ad Manager clickTag pattern
               ================================================================== */

        handleClick: function () {
          // Fire retargeting pixel for audience segmentation
          if (this.variables.reTargetingPixelUrl.length > 0) {
            this.appendReTargetingPixel();
          }

          // Open destination URL with click tracking
          this.openDestination();
        },

        /* ==================================================================
               OPEN DESTINATION - Handle clickthrough to destination URL
               
               REFACTORED: Extracted from handleClick for modularity
               Makes it easier to modify click behavior without touching pixel logic
               ================================================================== */

        openDestination: function () {
          var clickUrl = this.variables.clickMacroUrl + this.variables.destinationUrl;
          window.open(clickUrl, "_blank");
        },

        /* ==================================================================
               APPEND RETARGETING PIXEL - Fire retargeting tracking pixel
               
               Purpose: Adds users to retargeting audiences
               Method: Creates hidden 1×1 image with pixel URL
               Timing: Called immediately before clickthrough
               ================================================================== */

        appendReTargetingPixel: function () {
          var pixelImg = document.createElement("img");
          pixelImg.src = this.variables.reTargetingPixelUrl;
          pixelImg.style.display = "none";
          pixelImg.style.width = "1px";
          pixelImg.style.height = "1px";
          document.getElementById("container").appendChild(pixelImg);
        },

        /* ==================================================================
           FILL CANVAS - Determine content type and render appropriate banner
           
           PRIORITY ORDER (first match wins):
           1. Video banner (videoUrl) - NEW: Highest priority for video content
           2. Image banner (imageUrl)
           3. Iframe banner (iframeUrl)
           4. Inline HTML (html)
           
           After rendering content, show click overlay for interaction
           
           REFACTORED: Added video support as first priority to enable
           full-screen video experiences with custom controls
           ================================================================== */

        fillCanvas: function () {
          if (this.variables.videoUrl.length > 0) {
            this.setVideoContent();
          } else if (this.variables.imageUrl.length > 0) {
            this.setImageContent();
          } else if (this.variables.iframeUrl.length > 0) {
            this.setIframeContent();
          } else {
            document.getElementById("html").style.display = "block";
          }

          // Show click overlay after content is loaded
          document.getElementById("click-overlay").style.display = "block";
        },        /* ==================================================================
           SET VIDEO CONTENT - Render HTML5 video banner
           
           NEW METHOD: Handles video banner rendering
           
           Creates:
           - Video source element with videoUrl
           - Optional poster image (thumbnail before play)
           - Optional custom controls (play/pause, mute/unmute)
           
           Mobile Optimization:
           - autoplay + muted ensures playback on iOS/Android
           - playsinline prevents fullscreen mode on iOS
           - loop provides continuous playback
           - object-fit: contain maintains aspect ratio in 650×890 canvas
           
           User Controls:
           - videoControls variable shows/hides custom control buttons
           - Buttons positioned at top-right of video
           ================================================================== */

        setVideoContent: function () {
          var video = document.querySelector("#video video");
          
          // Create and append video source
          var source = document.createElement("source");
          source.src = this.variables.videoUrl;
          source.type = "video/mp4"; // Can be extended to support other formats
          video.appendChild(source);
          
          // Set poster image if provided (shown before playback starts)
          if (this.variables.posterUrl.length > 0) {
            video.poster = this.variables.posterUrl;
          }
          
          // Show video controls if videoControls variable is set to "visible"
          if (this.variables.videoControls === "visible") {
            document.getElementById("video-controls").style.display = "block";
          }
        },

        /* ==================================================================
           SET IMAGE CONTENT - Render static image banner
           
           Creates:
           - <img> element with imageUrl as source
           - 100% width/height to fill canvas
           - object-fit: contain to maintain image aspect ratio
           ================================================================== */

        setImageContent: function () {
          var image = document.createElement("img");
          image.src = this.variables.imageUrl;
          image.style.width = "100%";
          image.style.height = "100%";
          image.style.objectFit = "contain";
          document.getElementById("image").appendChild(image);
        },        /* ==================================================================
               SET IFRAME CONTENT - Render external HTML5 banner
               
               Creates iframe with clickTag and clickMacro URL parameters
               This allows the iframe content to handle clicks properly
               ================================================================== */

        setIframeContent: function () {
          var iframe = document.createElement("iframe");

          // Construct URL with clickTag parameters
          iframe.src = this.variables.iframeUrl + "?clickTag=" + this.variables.clickMacroUrl + this.variables.destinationUrl + "&clickMacro=" + this.variables.clickMacroUrl;

          // Iframe configuration for seamless integration
          iframe.scrolling = "no";
          iframe.rel = "nofollow";
          iframe.width = "100%";
          iframe.height = "100%";
          iframe.frameborder = "0";
          iframe.style.border = "none";
          iframe.style.overflow = "hidden";

          document.getElementById("iframe").appendChild(iframe);
        },

        /* ==================================================================
               CONFIGURE FRAME - Setup parent iframe and initialize interactions
               
               This method:
               1. Styles the parent iframe (fixed position, full viewport)
               2. Adds CSS animations to parent document
               3. Initializes countdown timer if timeout is set
               ================================================================== */

        configureFrame: function () {
          // Style the parent iframe
          this.setStylesToElement(window.frameElement, {
            position: "fixed",
            width: "100%",
            height: "100%",
            top: "0px",
            left: "0px",
            overflow: "hidden",
            zIndex: "10000",
          });

          // Add CSS class for additional styling via injected stylesheet
          window.frameElement.classList.add("fullscreen-banner-iframe");

          // Inject fade-in animation stylesheet into parent document
          this.injectParentStyles();

          // Initialize countdown timer if configured
          if (this.variables.timeout > 0) {
            this.initializeCountdown();
          }
        },

        /* ==================================================================
               INJECT PARENT STYLES - Add CSS to parent document
               
               REFACTORED: Extracted from configureFrame for better separation
               
               Why inject CSS into parent?
               - Styles the iframe element itself (can't be styled from inside)
               - Adds fade-in animation
               - Applies shadow for visual depth
               - CRITICAL: Prevents parent page scrolling while banner is active
               
               IMPORTANT: This function CANNOT be deleted without breaking:
               1. Iframe sizing (CSS inside iframe can't style the <iframe> tag)
               2. Visual polish (fade-in animation, shadow)
               3. Scroll prevention (locks parent page body)
               ================================================================== */

        injectParentStyles: function () {
          var css =
            /* Iframe styling - forces size and adds visual effects */
            ".fullscreen-banner-iframe { " +
            "width: 100vw !important; " +
            "height: 100dvh !important; " +
            "box-shadow: rgba(62, 62, 67, 0.75) 0px 0px 15px !important; " +
            "animation: easeStickyBannerIn 1s ease; " +
            "} " +
            /* Fade-in animation for smooth entrance */
            "@keyframes easeStickyBannerIn { " +
            "0% { opacity: 0; } " +
            "100% { opacity: 1; } " +
            "} " +
            /* SCROLL PREVENTION: Lock parent page body when banner is active */
            /* This prevents the underlying website from scrolling when user */
            /* interacts with the banner, especially on mobile where browser */
            /* UI appears/disappears causing unwanted scroll behavior */
            "body.banner-active { " +
            "overflow: hidden !important; " +
            "position: fixed !important; " +
            "width: 100% !important; " +
            "height: 100% !important; " +
            "}";

          this.appendStyleToParent(css);

          // Apply the scroll-lock class to parent body
          window.parent.document.body.classList.add("banner-active");
        },

        /* ==================================================================
               INITIALIZE COUNTDOWN - Setup auto-close timer
               
               REFACTORED: Extracted from configureFrame for modularity
               
               Sets up countdown timer with initial display
               Uses centralized updateCountdownDisplay method
               ================================================================== */

        initializeCountdown: function () {
          this.counter = this.variables.timeout;
          this.updateCountdownDisplay();
          this.countDown = setInterval(this.handleCountdownTick.bind(this), 1000);
        },

        /* ==================================================================
               HANDLE COUNTDOWN TICK - Process each countdown interval
               
               REFACTORED: Renamed from 'counting' to 'handleCountdownTick' for clarity
               
               Called every 1 second by setInterval
               Decrements counter and auto-closes at 0
               ================================================================== */

        handleCountdownTick: function () {
          this.counter = this.counter - 1;
          this.updateCountdownDisplay();

          if (this.counter < 1) {
            clearInterval(this.countDown);
            this.close();
          }
        },

        /* ==================================================================
               UPDATE COUNTDOWN DISPLAY - Centralized countdown text update
               
               REFACTORED: NEW METHOD - Eliminates duplicated countdown logic
               
               IMPROVEMENT: Single source of truth for countdown text formatting
               - Proper singular/plural handling
               - Called from both initialization and tick handler
               - Easy to modify countdown format in one place
               ================================================================== */

        updateCountdownDisplay: function () {
          var seconds = this.counter === 1 ? "second" : "seconds";
          document.getElementById("counter").innerHTML = "Reklaam sulgub " + this.counter + "s";
        },

        /* ==================================================================
               CLOSE - Remove banner from DOM
               
               Effect: Completely removes the parent iframe element
               Result: Banner disappears, page content becomes accessible again
               
               IMPORTANT: Also restores parent page scrolling ability
               ================================================================== */

        close: function () {
          // Restore parent page scrolling before removing banner
          window.parent.document.body.classList.remove("banner-active");

          // Remove iframe from DOM
          window.frameElement.outerHTML = "";
        },

        /* ==================================================================
               APPEND STYLE TO PARENT - Inject CSS into parent document
               
               Method: Creates <style> tag in parent's <head>
               
               Browser Compatibility:
               - Modern browsers: style.appendChild(textNode)
               - Legacy IE: style.styleSheet.cssText
               ================================================================== */

        appendStyleToParent: function (css) {
          var style = document.createElement("style");
          style.type = "text/css";

          if (style.styleSheet) {
            style.styleSheet.cssText = css; // Legacy IE
          } else {
            style.appendChild(document.createTextNode(css)); // Modern browsers
          }

          window.parent.document.getElementsByTagName("head")[0].appendChild(style);
        },

        /* ==================================================================
           TOGGLE VIDEO AUDIO - Mute/unmute video control
           
           UPDATED METHOD: Handles user interaction with audio button
           
           Functionality:
           - Checks current mute state
           - Toggles audio on/off
           - Swaps inline SVG icons (volume-on ↔ volume-off)
           
           Implementation:
           - Uses inline SVG elements instead of CSS background images
           - Toggles display property on SVG elements
           - volume-off shown by default (video starts muted)
           - volume-on shown when user unmutes
           
           Mobile Considerations:
           - Videos start muted for autoplay compatibility
           - User can unmute by clicking this button
           - Respects mobile browser autoplay policies
           ================================================================== */

        toggleVideoAudio: function () {
          var video = document.querySelector("#video video");
          var button = document.getElementById("video-control-audio");
          var volumeOnIcon = button.querySelector(".volume-on");
          var volumeOffIcon = button.querySelector(".volume-off");

          if (video.muted) {
            // Unmute video and show volume-on icon
            video.muted = false;
            volumeOnIcon.style.display = "block";
            volumeOffIcon.style.display = "none";
          } else {
            // Mute video and show volume-off icon
            video.muted = true;
            volumeOnIcon.style.display = "none";
            volumeOffIcon.style.display = "block";
          }
        },

        /* ==================================================================
           SET STYLES TO ELEMENT - Apply multiple CSS styles to element
           
           Parameters:
           - el: DOM element to style
           - styles: Object with CSS properties and values
           
           Features:
           - Handles single values: { color: "red" }
           - Handles arrays for vendor prefixes: { display: ["-webkit-flex", "flex"] }
           ================================================================== */

        setStylesToElement: function (el, styles) {
          var keys = Object.keys(styles);
          keys.forEach(function (key) {
            if (Array.isArray(styles[key])) {
              // Handle arrays (vendor prefixes)
              var css = el.style.cssText;
              styles[key].forEach(function (value) {
                css = css + " " + key + ": " + value + ";";
              });
              el.style.cssText = css;
            } else {
              // Handle single values
              el.style[key] = styles[key];
            }
          });
        },
      };      /* ====================================================================
           INITIALIZATION
           Start the banner build process when script loads
           ==================================================================== */

      banner.build();
    </script>
  </body>
</html>
