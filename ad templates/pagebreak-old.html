<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pagebreak v1.1</title>
		<style>
      html, body, div, img, video, iframe, a, button {
				cursor: pointer;
        margin: 0;
				padding: 0;
			}
			a:focus, button:focus {
				outline: none;
			}
      body {
        background-color: #eaeaea;
      }
			#container {
        position: absolute;
				height: 100%;
				width: 100%;
			}
      #canvas {
        position: absolute;
        height: 100%;
        width: 100%;
        margin-top: 20px;
        margin-bottom: 20px;
      }
      #top-padding-bar, #bottom-padding-bar {
        position: absolute;
        z-index: 2;
        background-color: #ffffff;
        width: 100%;
        height: 20px;
      }
      #top-padding-bar {
        top: -20px;
      }
      #bottom-padding-bar {
        bottom: 20px;
      }
			#tracking-code,
      #video-buttons,
      #html {
				display: none;
			}
      video {
        position: fixed;
        top: 50%;
        left: 50%;
        min-width: 100vw;
        min-height: 100vh;
        width: auto;
        height: auto;
        transform: translateX(-50%) translateY(-50%);
      }
			#video-buttons > button {
        position: absolute;
				background-color: transparent;
				background-size: 30px;
				width: 30px;
				height: 30px;
				border: none;
				z-index: 10;
				opacity: 0.7;
				border-radius: 15px;
        top: 10px;
			}
      #video-buttons-playback {
        right: 60px;
      }
      #video-buttons-audio {
        right: 25px;
      }
      #video-buttons > button:hover {
        opacity: 1;
      }
		  .play-btn {
		    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA6xJREFUeNrMmjFLI0EUx3cXiy2jRQgKkkZNly03KFw6k0LUQs8i4IFoLAKpLPwGgn6ARC3uUshdLFy7TWUCCnvdpgvYBAtZbEy5XW7eMfE2uew62Z2ZzINHQNHsb977v3k7b2SJkvX7/RT6SCBPIo9hH2cucgd7F1yWZTfq98sUHh5ci/gcHXAEZHMFQQDw4NmAVQ9rPeTNMEDyhACQNjmcQiwNgEwE1KEOgiAAQJf4GoAYJBqSCQBU9PGNQxT8zMEwTmgQBAEPv8dAC5MaROR7EIz8CQREQpXEsEAYOSCdjgWIBDGMH8jxFDVBUtEqowVA8alORBCGYSR2d3ezLy8vPNMPsmRr9IfKmH2CuMS+vb2pt7e3XzRNK56cnGgcYVK4q/CNSC7Mf31/f49dXFxsLi8v70OUOMFsYS0Pg+C2I9JDPD8/J7e3t4tra2ubHNJN9WaPNyJZWt/w9PSkrayslEE/jGH0QVQUTxdLtdS6rvtXP3Nzc+XLy8skw6ho3oikWC0Z6KdYLO6DfizLYrEvDYEwrzign0wmU87n8+uU9ZNAGRVTRssYazNNUwf9HB4e0uykU8o0dnDQz/X19frCwkKRkn6SCn7Hnoq9vr4mQD9oQ/0aUT8JRYTGsN1up0A/EdqdmBAgA4NyDfoJ0+4oorW2oJ9BuzOJfoQD8ZZr0A+0OyT6ERbE02HHHMf5VDczogLMzs72Dg4OWufn50RnXEKC7OzstJBOrMXFReKj1Bn8HizEAUM6ne5UKpWGruu9MFXLmTbA/Py8U61Wf9i2/SsMBARjBoNMZXdXVdUtlUoNUh0EWBdAuhL/o1Apl8tZKAqtSXRAAsLNlpaWurVa7T5kCvmDwPkQauU7LF+uBuX07Ozs/ujoiPbC9eDAblB+mYGADgqFQuvq6spitEb2xz4CgxUUlSztBnJ1ddW+ublpUNKBn1mjLUqTpg7u7u6qj4+P94wh7MHR6cfOTiMqoAPUgjdOT087HOoGAJh+LQr8Yi+MDjY2Nn7X6/WmxM+a3oPsoe4Xz+yIVzMej7ugg4eHhypnCBhpDxWP/8YKAozaSFIKxgq9wPcRHC4D/4GI9nMUYmxEPJERbfQGZvjN4EmGoaLAGEEXCUjG09Oe7Lo4nQJbG6ILA7gAbLHux8ZVJxyJTxvMSa9wpDCQyiEKzdESSw3EEx0dOwsg0IE56dWn0NecMJCGPeqe08MAVti7WzKNJYT5BNZPEkPFCFKnK/27eBb53OCPAAMA+baCsFpewH8AAAAASUVORK5CYII=');
		  }
		  .pause-btn {
		    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAmtJREFUeNrsmj2PgkAQhlliQUll6CQxJnRHaXcWFpaWV15l/AP+Desrr7xogx0lJaWxIrHBjpKSzttJBm/hBJYPlSVMMiEajPvwzs4OO0ukhux6vRr0olHXqavo9yyiHqD74ISQqO7/kwYGD27WHIcHToGOTwWhADDwWc5Tr2ohdacKECkJAGGzwBB6pAGQTYG8xkEoBABMpecagFg8c4hwACj08vkEFbIsQJigMgiFgMF/PGAulDVQ5DsPhhRAgBKK1A7LhSE54bRugRLcMFkg6xfOCZ6M9pVOAKRKdnJdV91ut4WL4G63c9jPm83GvFwuuSrP53N/tVr5RdmMgvywXwzurBOFKfZ0Oqn7/f6d4+klQA6Hw9v5fNaLfsQBYkBVwa4zcuqGhSSOLXEuJ0Gw7NAEAlHY6GEVmUni2TRWRWaqWFVAECWuvGNFDElcM9msZQoMotGIUmUMK9HNkAXLVFmmy/iOLbppsqDZKm1qV0D+lSg9SA/Sg3QYJOoKSNABjqgrID6A+D1Ii0AGsD9ES3lP4JerEDbs4vTrCazG8baOYGMlFBTETS+IjohqxFunNxABVQEAO6tEsQUCcdiN7MTeL+yl8mSw4XAYTSaT0ml7PB4XLr6j0YgnKqCl7SbGnr6jBa02npCCtkKYW/2iXFaLi8mfNMRdRRhl2tZ6A7OyevA8zdC2wFh5Bwl42tOv7uxGGE65yYXrwAAmgOUL6jEflSjMZGWPcBgIpDxBBSedYhsDYdSZoj8CCOaBXfboU+VjTghkotddc0IEcKue3SJNPELoT+D80RFK5QgdX/o7eFb7dftXgAEAB5bfhn2CSakAAAAASUVORK5CYII=');
		  }
		  .mute-btn {
		    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA8dJREFUeNrcmjFP20AUx3ORB48eo0SCMCCyxVKGGoFEt7LBgkqmdIhoti7hMzDAULYGhCgLamFJtjAllUDxmGwBlgQJlC1ekLzRe+iZOm7sXOKzfe2TTrYuiXM/v/d/985nEuNkLy8vGXpI0JamTcE2zkzaBth60Aghpt//JxwGD031OY4uNArUDhWEAsDA33vc9VnNoK05CxCZEgDCZh1DKEgDoDoF6nIHoRAAoMXCNQCpsmiIMADI9PApBC+42QBhBjODUAgY/HYAWpjWwCPfvWDIBAjwhBwTwzxhiEc4lQTwBDOMG0gpQk2wZLRvzgQQd8lOgUA8PDzIe3t7GZ+XgSjZdHbGx8wTgaTY3d1ddWlp6cvp6ek7DpfLYFXh6pF13gBHR0fpVCr1+eDgYMM0TZ6JYxO1/GqSo+zgFlK6riulUulDp9PJBKQVGaOnOQKCtRMXHZTLZe3y8nItBOFr1AE6CF+yVbEKDx2cnJysDYfDsNK2jJW3bnkk41cHVANr9/f36QjS8QiIOulO12q1rNvnEQFYlqARpUjONDbO+v2+EvFgJ6bjuMAz+DSWjuMa+1+3RFyUwrBarSZUVf0I6dueyldXVzfsfW5liyQCCEye+Xy+ADP/8vKy0mq1zqCfnheenp4S9JiAvrm5OdeVoiSCNzRNM3K5XPfm5kbFgRegH87huLCwMPCCGFv9RmXX19e1lZWVtgVgQUAffDbp93GRFHt+fn4ly/LbnYdz6GP5rTAgIGgIKXuFjJopMIhdDBALwh5O9jBjgZFwHSzKA4YRTdDUG4MEwCr2QdSDh0FCei0Wi1d2YcM5XRLUGMRuCgFiwRwfH+vO/v39fZbnwD0A6f0HJUpPYgGZn583FhcXx37v+flZtkQaJQjBFeK2n8XVNCtDuCF3d3dnHCEMutT9aqXfrp8rQRxTq2xtbf2yT2ghWfttHsGNFcOvWC8uLpqNRqOSzWa7IYLozgmxyasApN75WalUzpLJZNAZsW09On0D4eEVu+3s7PQeHx8rMA8EFG5wzbpbiVLn/W+gn9vb20PQD+dLN+0PskdAcM+Oe3xb+qGz9yFdBfa5pFtCRibPv7YVBNhqYwkp2FYwPKtfdFcVfyCi/XBCjPWIzTOibb29PqNw24Nn2QwVBabq9SIBy/Z01Du7JoaTZ03I9MIAJoDNmM+H3bNkJ/TExPlt2lc4Mggkh+CFpjPFcgOxeUfDFgQQ6KA+7atPM7/mhEAqNr9zjoEA+qzvbhEetxD2J1A/aYRSGEKnF/vz4pnv4vK3AAMAaAK6HQHqFXAAAAAASUVORK5CYII=');
		  }
		  .audio-btn {
		    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABTtJREFUeNrUWk8sa0sc7mlu8rpTNq8hkVqgsaCJiEokSIiK0FrgsuCF0Lsg3ZAgsbCyYPHuQqISXLuHhYqFCgsSoiKSstFLJH2E9IVQsenOm69vpq/pa885Pee0p++XTEZqOp1vvt/fmeE0Csnn56eJdAbSjKTpaUskYdKCtAXQOI4Ly/19ToHFo5llrsOPRgD5MgqEAMDC63l2XaqESDuUAohLEQDUxkpVKJ0CQB4CyK84EAICACyazAqAuMXYECcCgI50v2WAhWQSpGCCkoEQEFj81zTYQqoCRn7wgeEEQIAJnSY7hBcMx6NO37KACdFgkgH5pqJNiPFoi/EOQJvEO6UFhNvtNni9Xrks4/v2+A+1CeKE4i72/v5eV1tba+vo6HBcXV0poa4mmlVE5UvcAKvSILq6uup3dnaqw+Gw0k7DTsD8zlRMG5d2KKZSs7Ozpry8POfm5mZdKiDAXkFBgWNpackoMFQXqz2xqlWvBADYQElJSf/U1FT329ubPlUVrKmp6X96ejI4nc5uEfZkoR72HyBU3/Ry7aClpaWZLMR5e3trlLshYLGvr88mghVzLCMmOT86NDRkKS0tdXo8HotUb2Y2m7vx9+np6ZpOp4voPTZkfHxcqEQwxxo772CoSrL/vby86FNVoXjp6enpBwPt7e0an8+3PjIysjc/Px9hY3l5uW5ubo4vrTcQjdJr491YIsHOJGtyQLDdxsLRX15emmDkWHhxcTGqRw3mF8GKSatWBIc6YtfhnrHwioqKSO0xMTERYcJms12ysfv7+6UC0xm1tMbOuExPT/tyc3NDcM/wTouLi3uMAcYKsxUwJTCdQatWYlhYWBgeHBw8wt8zMzPVFoslxFjZ2tqKMEAcSICNF4gretWAQLDrYOXs7Cyy41VVVX+iv7u7M1An8xcbe35+zmsCWrVT2bKysgDUCXGIAAky54K+sbExysj7+7suq4Hk5+e/oycxyGC1WoNS51EdSLzd/G+BfHx8/IK+vLw8JCJRzF4gMHS4WXgtYht6qm7BeAPPyckJCwEJqwUCDMDQKysr/bGBr6ioKALk+vr6VzaWOQI+IEG1gJD40YyeRPgjBEUW+FpbW3+iv7i4iAZCAUcQ/kKBZDy6I0VB3UEW6IVaoRTG54grk5OTfhRmrCBDoBRwBAEACWgyfxQaSVGgOru7u3tQsZOTk0hiyKL96upqNRvb1NT0U2C6KBBeYZloInl4eDBIqcexw8fHx9uxiSJ+B9EewFhQhCMYHR31CwJB8U5SeT9fcXVzc7PGVxk6HI46qUUVZGVlZX1gYKD74OBgHfMxYJC2trYzAbUK4cCOuV+/1EXgR6AepLL7zscc73GI3R58fX39jrlIcWVjNQ7c8MbGxqHA133ROEIvVkJydB4GC+ZcLtcaDFZq3f/8/BxNYhcWFrbFnHfEB8RDJYx4eHg4gN3t7Ow8YvVEKuyiZgcTY2Nj22BKiA12rhU9oAMrxFbqlUrroRJkh729vb3NzCOJBfP4+OgSc9CCXDNZiuJROgmEZyKFkkuq/fDIYexB9n9O4wkrX+UeD/GdPjY0NARhTzKnwpX2j9gPEgFR+6pNjErhWiHEm/1SutxqJpMC8kc8iISMxDCTbVdvEHeyO3gxl6HZAsbN95BAzPW02je7YapOvF5P1IMB6gDs6fJmfN6JMiHo5VJ9wmGigHQZYAFxwiv2Cyk/qqHsWGhLByDYgSfVp0+SnzlRQGba5MacEAXglfp2i1NiC3E/Qe3HSEHpRahOQPPvwzPZ5wZ/CzAAND56pT+PWnQAAAAASUVORK5CYII=');
		  }
      #click-overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        top: 0;
        display: none;
      }
		</style>
	</head>
	<body>
		<div id="container">
      <div id="click-overlay" onclick="event.stopPropagation(); banner.click();"></div>
			<div id="canvas">
        <div id="top-padding-bar"></div>
				<div id="image" onclick="banner.click()"></div>
				<div id="video">
			    <div id="video-buttons">
		        <button id="video-buttons-playback" class="pause-btn" onclick="banner.toggleVideoPlayback()"></button>
		        <button id="video-buttons-audio" class="audio-btn" onclick="banner.toggleVideoAudio()"></button>
			    </div>
				</div>
				<div id="iframe"></div>
				<div id="html">[%html%]</div>
        <div id="bottom-padding-bar"></div>
			</div>
			<div id="tracking-code">[%trackingCode%]</div>
		</div>

    <script>
      var banner = {
        build: function () {
          this.setVariables()
          this.fillCanvas()
          this.configureFrame()
        },


        setVariables: function () {
          this.variables = {}
          this.setVariable('adUnit', '%%ADUNIT%%')
          this.setVariable('width', '%%WIDTH%%')
          this.setVariable('height', '%%HEIGHT%%')
          this.setVariable('cachebuster', '%%CACHEBUSTER%%')
          this.setVariable('clickMacroUrl', '%%CLICK_URL_ESC%%')
          this.setVariable('destinationUrl', '%%DEST_URL_ESC%%')
          this.setVariable('type', '[%type%]')
          this.setVariable('imageUrl', '[%imageUrl%]')
          this.setVariable('videoUrl', '[%videoUrl%]')
          this.setVariable('iframeUrl', '[%iframeUrl%]')
          this.setVariable('iframeClickTagType', '[%iframeClickTagType%]')
          this.setVariable('videoButtons', '[%videoButtons%]')
          this.setVariable('reTargetingPixelUrl', '[%reTargetingPixelUrl%]')
          this.setVariable("auth", "%%PATTERN:NewMobilePage%%")
        },


			  setVariable: function (name, value) {
					this.variables[name] = value.length > 0 ? value : ''
				},


			  click: function () {
          if(this.variables.reTargetingPixelUrl.length > 0) {
            this.appendReTargetingPixel();
          }
					window.open(this.variables.clickMacroUrl + this.variables.destinationUrl, '_blank')
				},

        appendReTargetingPixel: function () {
          var pixelImg = document.createElement('img');
          pixelImg.src = this.variables.reTargetingPixelUrl;
          document.getElementById('container').appendChild(pixelImg);
        },

        fillCanvas: function () {
          if (this.variables.imageUrl.length > 0) {
            this.setImageContent()
          } else if (this.variables.videoUrl.length > 0) {
            this.setVideoContent()
          } else if (this.variables.iframeUrl.length > 0) {
            this.setIframeContent()
          } else {
            document.getElementById('html').style.display = 'block'
          }

					if (this.variables.iframeClickTagType === 'simple') {
						document.getElementById('click-overlay').style.display = 'block';
					}
        },


        setImageContent: function () {
          this.setStylesToElement(document.getElementById('image'), {
            width: '100%',
            height: 'calc(100% - 40px)',
            backgroundImage: 'url("' + this.variables.imageUrl + '")',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center center',
            backgroundSize: this.variables.type != 'responsive' ? 'contain' : 'cover',
          })
        },


        setVideoContent: function () {
          var video = document.createElement('video')
          video.autoplay = 'autoplay'
          video.loop = 'loop'
          video.muted = 'muted'
          video.setAttribute('playsinline', 'playsinline')
          video.setAttribute('webkit-playsinline', 'webkit-playsinline')
          video.onclick = function () { this.click() }.bind(this)
          document.getElementById('video').appendChild(video)

          var source = document.createElement('source')
          source.src = this.variables.videoUrl
          document.getElementsByTagName('video')[0].appendChild(source)

          document.getElementById('video-buttons').style.display = this.variables.videoButtons === 'visible' ? 'block' : 'none'

          this.setStylesToElement(document.getElementsByTagName('video')[0], {
            width: '100%',
            height: '100%',
          })
        },


        setIframeContent: function () {
          var iframe = document.createElement('iframe')
          iframe.src = this.variables.iframeUrl + '?clickTag=' + this.variables.clickMacroUrl + this.variables.destinationUrl + '&clickMacro=' + this.variables.clickMacroUrl
          iframe.scrolling = 'no'
          iframe.rel = 'nofollow'
          iframe.width = '100%'
          iframe.height = '100%'
          iframe.frameborder = '0px';
          iframe.style.border = 'none';
          iframe.style.overflow = 'hidden';

          if(this.variables.type === 'responsive') {
            iframe.style.height = '100vh'
          } else if (this.variables.type === '16:9') {
            iframe.style.height = 100/(16/9) + 'vw'
          } else if (this.variables.type === '9:16') {
            iframe.style.height = 100/(9/16) + 'vw'
          }

          document.getElementById('iframe').appendChild(iframe)
        },


        toggleVideoPlayback: function () {
          var video = document.getElementsByTagName('video')[0]
          var button = document.getElementById('video-buttons-playback');

          if (video.paused) {
            video.play();
            button.classList.remove('play-btn');
            button.classList.add('pause-btn');
          } else {
            video.pause();
            button.classList.remove('pause-btn');
            button.classList.add('play-btn');
          }
        },


        toggleVideoAudio: function () {
          var video = document.getElementsByTagName('video')[0]
          var button = document.getElementById('video-buttons-audio');

          if (video.muted) {
            video.muted = false;
            button.classList.remove('audio-btn');
            button.classList.add('mute-btn');
          } else {
            video.muted = true;
            button.classList.remove('mute-btn');
            button.classList.add('audio-btn');
          }
        },


        configureFrame: function () {
          this.setStylesToElement(window.frameElement, {
            position: 'absolute',
            width: '100vw',
            transform: 'translateX(-50%)',
            zIndex: '100'
          })

          this.setStylesToElement(window.frameElement.parentNode, {
            marginTop: '-20px',
            marginBottom: '-20px',
          })

          if(this.variables.type === 'responsive') {
            window.frameElement.style.height = 'calc(100vh + 40px)'
  					window.frameElement.parentNode.style.height = 'calc(100vh + 40px)'
          } else if (this.variables.type === '16:9') {
            window.frameElement.style.height = 'calc(' + 100/(16/9) + 'vw + 40px)'
            window.frameElement.parentNode.style.height = 'calc(' + 100/(16/9) + 'vw + 40px)'
          } else if (this.variables.type === '9:16') {
            window.frameElement.style.height = 'calc(' + 100/(9/16) + 'vw + 40px)'
            window.frameElement.parentNode.style.height = 'calc(' + 100/(9/16) + 'vw + 40px)'
          }
          
          if(this.variables.auth != 'true') {
            this.setStylesToElement(window.frameElement, {
            });
          }
          else {
            //svelte
            this.setStylesToElement(window.frameElement, {
            }); 
          }
        },


        setStylesToElement: function (el, styles) {
          if(el===null || typeof el == 'undefined'){return null;}
          var keys = Object.keys(styles)
          keys.forEach(function(key) {
            if(Array.isArray(styles[key])) {
              var css = el.style.cssText
              styles[key].forEach(function(value) {
                css = css + ' ' + key + ': ' + value + ';'
              })
              el.style.cssText = css
            } else {
              el.style[key] = styles[key]
            }
          })
        },
      }

      banner.build()
    </script>
	</body>
</html>
